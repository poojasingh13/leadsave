<title>Leads</title>
</head>
<body class="dt-example dt-example-bootstrap">
	<div class="container">
		<section>
			<span class="pull-right logoInside">
				<img src="media/images/logo-inner.png" class="pull-right" >
			</span>
			<h1 class=" pull-left heading">Leads</h1>
			<div class="clearfix"></div>
			<div class="row">
			<form method="post" class="col-md-12 col-sm-12 col-xs-12 cls_insert" action="logout.php">
				<button type="submit" class="btn btn-default pull-right log">Logout</button>
			</form>
			</div>
			<div class="clearfix">&nbsp;</div>
			<div class="table-responsive">
				<table id="example" class="table table-striped table-bordered table-condensed" cellspacing="0" width="100%">
					<thead>
						<tr>
							<th class="nosorting">No</th>
							<th>Name</th>
							<th>Email</th>
							<th>Mobile</th>
							<th>city</th>
							<th>Date</th>
							<th>Status</th>							
							<th>Edit / Delete</th>
						</tr>
					</thead>
					<tfoot>
						<tr>
							<th>No</th>
							<th>Name</th>
							<th>Email</th>
							<th>Mobile</th>
							<th>city</th>							
							<th>Date</th>
							<th>Status</th>
							<th>Edit / Delete</th>
							
						</tr>
					</tfoot>
				</table>
			</div>	
		</section>
	</div>
	<script type="text/javascript" language="javascript" class="init">
	var t ;
	$(document).ready(function() {
			t = $('#example').DataTable( {
				"processing": true,
				"serverSide": true,
				"ajax": "server_processing.php",
				"aoColumnDefs" : [
				 {
				   'bSortable' : false,
				   'aTargets' : [ 1,2,3,6,7 ]
				 }],
				 "fnCreatedRow": function (row, data, index) {
					$('td', row).eq(0).html(index + 1);
				},
				columns: [
					{ data: null, render: function ( data, type, row ) {                
							return '';
						}
					},
					{ data: null, render: function ( data, type, row ) {                
						return data[1];
						}
					},
					{ data: null, render: function ( data, type, row ) {                
						return data[2];
						} 
					},
					{ data: null, render: function ( data, type, row ) {                
						return data[3];
						} 
					},
					{ data: null, render: function ( data, type, row ) {                
						return data[4];
						} 
					},					
					{ data: null, render: function ( data, type, row ) {                
						return data[6];
						} 
					},
					{ data: null, render: function ( data, type, row ) {
						var status;
						if(data[5] == '1'){
							status = 'A';
						}else if(data[5] == '2'){
							status = 'B';
						}else if(data[5] == '3'){
							status = 'c';
						}
						return '<span class="cls_userstatus">'+status+'</span><span style="display:none" class="cls_userstatuslist"><select class="cls_status"><option value="1">A</option><option value="2">B</option><option value="3">c</option></select></span>';
						} 
					},
					{
						data: null,
						className: "center",
						render: function ( data, type, row ) {                
						return '<span class="cls_userinfoedit"><a href="javascript:void(0)" data-id="'+data[0]+'"  class="editor_edit">Edit</a> / <a href="javascript:void(0)" data-id="'+data[0]+'" class="editor_remove">Delete</a> </span>'+
						'<span class="cls_userinfoupdate" style="display:none"><a href="javascript:void(0)" data-id="'+data[0]+'"  class="editor_update">Update</a> / <a href="javascript:void(0)" data-id="'+data[0]+'" class="editor_cancel">Cancel</a></span>';
						} 
						//defaultContent: '<a href="" data-id="'+data[5]+'"  class="editor_edit">Edit</a> / <a href="" class="editor_remove">Delete</a>'
					}
				]
			});		
		} );
	
		$(document).on('click','.editor_edit',function(){
			$(this).closest('.cls_userinfoedit').toggle();	
			$(this).closest('.cls_userinfoedit').next('.cls_userinfoupdate').toggle();
			$(this).closest('tr').find('.cls_userstatuslist').toggle();
			$(this).closest('tr').find('.cls_userstatus').toggle();
		});
		$(document).on('click','.editor_update',function(){
			var obj = $(this);
			var userid = $(this).data('id');			
			$.ajax({
			  url: "lead.php",
			  data: {'id':'update','userid':userid,'status':obj.closest('tr').find('.cls_status').val()}
			}).done(function(r) {
				if(r.res) {
						alert('status updated Successfully');						
						t.ajax.reload( null, false );
				} else {					
					alert('Oops!! Some error occured.');
				}	
			});
			});
			$(document).on('click','.editor_remove',function(){
				var obj = $(this);
				var userid = $(this).data('id');
				var rtn = confirm('Are you sure to delete this user??');
				if(rtn){
					$.ajax({
					  url: "lead.php",
					  data: {'id':'delete','userid':userid}
					}).done(function(r) {
						if(r.res) {
								alert('User deleted Successfully');
								t.ajax.reload( null, false );
								
						} else {							
							alert('Oops!! Some error occured.');
						}	
					});	
				}
			});
			
			$(document).on('click','.editor_cancel',function(){
				hideUpdate($(this));
			});
			function hideUpdate(obj){
				obj.closest('.cls_userinfoupdate').toggle();	
				obj.closest('.cls_userinfoupdate').prev('.cls_userinfoedit').toggle();
				obj.closest('tr').find('.cls_userstatuslist').toggle();
				obj.closest('tr').find('.cls_userstatus').toggle();
			}
	</script>
	
	
</body>
</html>